<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="create-the-environment">Create the environment</h1>
<ol type="1">
<li><p><a
href="https://ubuntu.com/tutorials/how-to-run-ubuntu-desktop-on-a-virtual-machine-using-virtualbox#1-overview">Create
Ubuntu VM from the .iso image</a></p>
<ul>
<li><p>Please Skip Unattended Installation, otherwise your user cannot
get root privilege</p></li>
<li><p>[optional] “Guest addition” in VBox can help to use full screen,
copy/paste and share files with the host, you can install it based on <a
href="https://www.virtualbox.org/manual/ch04.html#additions-linux">“Installing
the Linux Guest Additions”</a> and <a
href="https://help.ubuntu.com/community/VirtualBox/GuestAdditions">“Setting
up VirtualBox Guest Additions”</a></p></li>
</ul></li>
</ol>
<figure>
<img src="images/fig1.png%20=600x300"
alt="Skip Unattended Installation" />
<figcaption aria-hidden="true">Skip Unattended Installation</figcaption>
</figure>
<!-- <img src="images/fig1.png" width="600" height="300"> -->
<ol start="2" type="1">
<li><a href="https://code.visualstudio.com/download">Install VS
Code</a></li>
<li>Remember to install python3-venv, otherwise the PlatformIO cannot
run</li>
</ol>
<pre class="shell"><code>sudo apt-get install python3-venv</code></pre>
<ol start="4" type="1">
<li><a href="https://platformio.org/install/ide?install=vscode">Install
PlatformIO IDE for VSCode</a></li>
<li>Add the user <em>IoT</em> into the group dialout so that
<em>IoT</em> can use ttyusb0
<ul>
<li><a
href="https://askubuntu.com/questions/133235/how-do-i-allow-non-root-access-to-ttyusb0">Permission
denied: ’/dev/ttyUSB0</a></li>
</ul></li>
</ol>
<pre><code>sudo usermod -a -G dialout $USER</code></pre>
<ol start="5" type="1">
<li>For ease of transferring files out of Ubuntu VM to the host
computer, a <a
href="https://net2.com/how-to-share-folders-between-your-ubuntu-virtualbox-and-your-host-machine/">shared
folder</a> can be created.</li>
</ol>
<h1 id="programming">Programming</h1>
<p>There are at least four options of programming for ESP32: VS Code +
PlatformIO, VS Code + ESP-IDF, Native ESP-IDF programming environment,
and Arduino IDE. Arduino IDE is easy to use, but with limited
functionalities such as debugging. VS Code + ESP-IDF and the native
ESP-IDF programming environment are essentionally the same while VS Code
+ ESP-IDF provides a GUI interface and a user does not need to remember
various ESP-IDF commands. VS Code + PlatformIO supports both Arduino
framework and ESP-IDF programming framework. An Arduino ESP32 project
can be imported into VS Code + PlatformIO. The ESP-IDF fromawork under
VS Code + PlatformIO is smililar to VS Code + ESP-IDF and naive ESP-IDF
programming environment, but their configugration grammars are
different. We use VS Code + PlatformIO, Native ESP-IDF programming
environment and Arduino IDE.</p>
<h2 id="vscode-platformio">VSCode + PlatformIO</h2>
<p>The detailed installation of VSCode and PlatformIO can be found in <a
href="https://docs.platformio.org/en/latest/integration/ide/vscode.html#installation">“PlatformIO
IDE for VSCode”</a>. To set up the project:</p>
<ol type="1">
<li>Click on “PlatformIO” Logo on the side to launch PlatformIO,</li>
</ol>
<figure>
<img src="images/fig3.png" alt="PlatformIO" />
<figcaption aria-hidden="true">PlatformIO</figcaption>
</figure>
<ol start="2" type="1">
<li>Click on “PlatformIO Home” button on the bottom <a
href="https://docs.platformio.org/en/latest/integration/ide/vscode.html#ide-vscode-toolbar">PlatformIO
Toolbar</a></li>
<li>Click on “New Project”, select a board and create new PlatformIO
Project</li>
<li></li>
</ol>
<p>The detailed tutorial of PlatformIO can be found in <a
href="https://docs.platformio.org/en/stable/tutorials/espressif32/espidf_debugging_unit_testing_analysis.html">“Get
started with ESP-IDF and ESP32-DevKitC: debugging, unit testing, project
analysis”</a>. The core steps are:</p>
<h3 id="platformioesp-idf-framework">PlatformIO–ESP-IDF framework</h3>
<p>This is a great tutorial on using <a
href="https://docs.platformio.org/en/latest/platforms/espressif32.html#tutorials">PlatformIO
with VS Code</a>.</p>
<ol type="1">
<li>Clone <a href="https://github.com/UncleRus/esp-idf-lib">ESP-IDF
Components library</a></li>
<li>Use ESP-IDF on PlatformIO: <a
href="https://docs.platformio.org/en/latest/frameworks/espidf.html#examples">Espressif
IoT Development Framework under PlatformIO</a>
<ul>
<li>Adding EXTRA_COMPONENT_DIRS for ESP-IDF on the PlatformIO extension
(different from the way it is added to the ESP-IDF extension). Using
EXTRA_COMPONENT_DIRS option in the root CMakeLists.txt file</li>
</ul></li>
</ol>
<pre><code>list(APPEND EXTRA_COMPONENT_DIRS esp-aws-iot)</code></pre>
<ol start="3" type="1">
<li><a
href="https://docs.platformio.org/en/stable/tutorials/espressif32/espidf_debugging_unit_testing_analysis.html">Get
started with ESP-IDF and ESP32-DevKitC: debugging, unit testing, project
analysis</a>
<ul>
<li>Note: follow the steps. Otherwise, errors such as monitor speed rate
may happen</li>
<li><a
href="https://community.platformio.org/t/pio-libdeps-esp32dev-dht-sensor-library-dht-u-h29-fatal-error-adafruit-sensor-h-no-such-file-or-directory/21861">pio32devsensor
library_U.h:36:29: fatal error: Adafruit_Sensor.h: No such file or
directory</a>
<ul>
<li>The solution is simple. Add the following include statements to
main.cpp:</li>
</ul></li>
</ul></li>
</ol>
<pre><code>#include &lt;Adafruit_Sensor.h&gt;</code></pre>
<p>Using <em>PlatformIO</em> -&gt; <em>Build</em>/<em>Upload</em> is the
most reliable way to build a project and upload the firmware.</p>
<p><img src="../imgs/PlatformIO-Build-Upload.png"></p>
<h3 id="using-native-esp-idf-project-with-platformio">Using Native
ESP-IDF Project with PlatformIO</h3>
<p>Here is an introduction on <a
href="https://docs.platformio.org/en/stable/frameworks/espidf.html">Espressif
IoT Development Framework</a> within PlatformIO. Looks useful when a
native ESP-IDF project is imported into PlatformIO.</p>
<ul>
<li>Create a PlatformIO project using the ESP-IDF framework</li>
<li>Keep the platformio.ini file and remove all other files.</li>
<li>Copy the native esp-idf files and folders to the PlatformIO project
folder.</li>
<li>Use the src<em>dir option in platformio.ini to to specify _main</em>
as the folder with source files. Here is an example</li>
</ul>
<pre><code>[platformio]
src_dir = main

[env:esp32dev]
platform = espressif32
framework = espidf
board = esp32dev</code></pre>
<p>Seems the approach works.</p>
<h2 id="vs-code-esp-idf">VS Code + ESP-IDF</h2>
<ol type="1">
<li><a
href="https://github.com/espressif/vscode-esp-idf-extension/blob/master/docs/tutorial/install.md">Installation</a></li>
<li><a
href="https://github.com/espressif/vscode-esp-idf-extension/blob/master/docs/tutorial/basic_use.md">Basic
use of the extension</a></li>
</ol>
<p>Load, build and flash an example project</p>
<ul>
<li>Start VS Code</li>
<li>File -&gt; Open Folder
<ul>
<li>Example project: /home/iot/esp/esp-idf/examples/wifi/scan</li>
</ul></li>
<li>ESP-IDF Build project</li>
<li>ESP-IDF Flash device -&gt; UART
<ul>
<li>If “No such file or directory: ‘/dev/ttyUSB1’”, pressing F1, typing
“ESP-IDF: Select port to use:” -&gt; /dev/ttyUSB0</li>
<li>During connecting to /dev/ttyUSB0, may need to hold the BOOT (IO0)
button of the ESP32 until uploading starts</li>
<li>If still errors, unplug and re-plug the kit</li>
<li>If still errors, change a USB port since different USB ports may
provide different power supplies</li>
</ul></li>
<li>ESP-IDF Monitor device</li>
<li>Press reset button of the IoT kit</li>
<li>File -&gt; Close Folder</li>
<li>Close a project</li>
</ul>
<p>If IDF_PATH has issue, refer to <a
href="https://docs.espressif.com/projects/esp-idf/en/v3.3.1/get-started-cmake/add-idf_path-to-profile.html">Add
IDF_PATH &amp; idf.py PATH to User Profile</a></p>
<h3 id="load-a-project">Load a project</h3>
<p>Load a project by opening the project folder.</p>
<p><img src="../imgs/vscode-espidf-openfolder.png"></p>
<h3 id="build-upload-firmware-via-icons">Build, upload firmware via
icons</h3>
<p><img src="../imgs/vscode-espidf-icons.png"></p>
<h2 id="native-esp-idf-programming-environment">Native ESP-IDF
programming environment</h2>
<p>This is a great guide on <a
href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32/get-started/">Get
Started - ESP32 - — ESP-IDF Programming Guide</a>.</p>
<p>Set up the environment variables</p>
<pre><code>. $HOME/esp/esp-idf/export.sh</code></pre>
<h2 id="troubleshooting">Troubleshooting</h2>
<ul>
<li><p>If you can’t change to the root user in VBox, or its said “xxx is
not in the sudoers file. This incident will be reported.”, try
<code>su root</code>, the password is the same password you set during
the installation</p></li>
<li><p>If the VBox screen turns to black, and you cannot wake it up, you
can choose from the menu: View -&gt; Virtual Screen 1 -&gt; Resize to
*** x *** (choose one you like), then VBox will wake up</p></li>
<li><p>If you meet the error: “The Python interpreter is not compatible.
Reason: Could not find distutils module at …”, please run</p>
<pre class="shell"><code>sudo apt-get install python3-venv</code></pre></li>
</ul>
<figure>
<img src="images/fig2.png%20=600x400"
alt="Python interpreter is not cmpatible" />
<figcaption aria-hidden="true">Python interpreter is not
cmpatible</figcaption>
</figure>
<ul>
<li>Use a correct micro USB cable that supports both data transfer and
power supply, like the typical smartphone micro USB cable</li>
<li>Use a correct USB-serial device such as /dev/ttyUSB0</li>
<li>During connecting to /dev/ttyUSB0, may need to hold the BOOT (IO0)
button of the ESP32 until uploading starts</li>
<li>Press reset if no output from the serial port</li>
<li>If still errors, unplug and re-plug t%he kit</li>
<li>If still errors, change a USB port since different USB ports may
provide different power supplies</li>
</ul>
</body>
</html>
